<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>X-O Ø§Ù„Ø³Ø±ÙŠØ¹Ø© âš¡</title>
    <style>
        body { background: #121212; color: white; text-align: center; font-family: sans-serif; }
        .grid { display: grid; grid-template-columns: repeat(3, 100px); gap: 10px; justify-content: center; margin-top: 20px; }
        .cell { width: 100px; height: 100px; background: #1e1e1e; font-size: 3rem; display: flex; align-items: center; justify-content: center; cursor: pointer; border-radius: 10px; border: 2px solid #333; }
        .cell:empty:hover { background: #252525; }
        #info { margin: 20px; font-size: 1.2rem; color: #4ecca3; }
    </style>
</head>
<body>

    <h2>Ù„Ø¹Ø¨Ø© X-O Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† ğŸ®</h2>
    <div id="info">Ø§Ù†ØªØ¸Ø± ØªØ­Ø¯ÙŠØ¯ Ø¯ÙˆØ±Ùƒ...</div>
    <div id="status" style="margin-bottom: 10px;"></div>

    <div class="grid">
        <div class="cell" onclick="hit(0)"></div>
        <div class="cell" onclick="hit(1)"></div>
        <div class="cell" onclick="hit(2)"></div>
        <div class="cell" onclick="hit(3)"></div>
        <div class="cell" onclick="hit(4)"></div>
        <div class="cell" onclick="hit(5)"></div>
        <div class="cell" onclick="hit(6)"></div>
        <div class="cell" onclick="hit(7)"></div>
        <div class="cell" onclick="hit(8)"></div>
    </div>

    <button onclick="clearRoom()" style="margin-top: 30px; padding: 10px 20px; cursor: pointer;">ØªØµÙÙŠØ± Ø§Ù„ØºØ±ÙØ© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„</button>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <script>
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§ØªÙƒ Ø§Ù„Ø£ØµÙ„ÙŠØ©
        const config = {
            apiKey: "AIzaSyBopnQ0bLP60tuYXxlFUeKRfeesXDfz3MI",
            databaseURL: "https://x-o2-fa961-default-rtdb.firebaseio.com"
        };
        firebase.initializeApp(config);

        const roomID = prompt("Ø±Ù‚Ù… Ø§Ù„ØºØ±ÙØ©:", "1") || "1";
        const db = firebase.database().ref('rooms/' + roomID);
        
        // Ø¨ØµÙ…Ø© ÙØ±ÙŠØ¯Ø© Ù„ÙƒÙ„ Ø¬Ù‡Ø§Ø²
        const myID = "ID_" + Math.floor(Math.random() * 100000);
        let mySym = "";

        // Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø¬Ø²: Ø§Ù„Ø£ÙˆÙ„ X ÙˆØ§Ù„Ø«Ø§Ù†ÙŠ O
        db.child('users').transaction(u => {
            if (!u) return { x: myID, o: null }; // Ø§Ù„Ø£ÙˆÙ„
            if (u.x === myID) return u; // Ø£Ù†Øª Ø£ØµÙ„Ø§Ù‹ X
            if (!u.o) return { x: u.x, o: myID }; // Ø§Ù„Ø«Ø§Ù†ÙŠ
            return u;
        }, (err, comm, snap) => {
            const val = snap.val();
            mySym = (val.x === myID) ? "X" : (val.o === myID ? "O" : "Ù…Ø´Ø§Ù‡Ø¯");
            document.getElementById('info').innerText = "Ø£Ù†Øª Ø§Ù„Ù„Ø§Ø¹Ø¨: " + mySym;
        });

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù„ÙˆØ­Ø©
        db.child('play').on('value', snap => {
            const data = snap.val() || { b: Array(9).fill(""), t: "X" };
            const cells = document.querySelectorAll('.cell');
            data.b.forEach((v, i) => cells[i].innerText = v);
            document.getElementById('status').innerText = (data.t === mySym) ? "Ø¯ÙˆØ±Ùƒ Ø§Ù„Ø¢Ù†" : "Ø§Ù†ØªØ¸Ø± Ø§Ù„Ø®ØµÙ…";
        });

        function hit(i) {
            db.child('play').once('value', snap => {
                const data = snap.val() || { b: Array(9).fill(""), t: "X" };
                if (data.b[i] === "" && data.t === mySym) {
                    data.b[i] = mySym;
                    data.t = (mySym === "X") ? "O" : "X";
                    db.child('play').set(data);
                }
            });
        }

        function clearRoom() {
            if(confirm("Ø³ÙŠØªÙ… Ø·Ø±Ø¯ Ø§Ù„Ø¬Ù…ÙŠØ¹ ÙˆØªØµÙÙŠØ± Ø§Ù„Ø¯ÙˆØ±ØŒ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ")) {
                db.remove();
                location.reload();
            }
        }
    </script>
</body>
</html>
